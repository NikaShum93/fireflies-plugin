<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Fireflies</title>
  <style>
    html, body {
      margin: 0;
      background: transparent;
      overflow: hidden;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
<canvas id="canvas"></canvas>

<script>
const params = new URLSearchParams(window.location.search);
const color = params.get("color") || "#ffffaa";
const effect = params.get("effect") || "glow";
const fireflySize = parseFloat(params.get("fireflySize")) || 4;

const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

function randomColor() {
  const colors = ["#ffcc33", "#99ccff", "#ccffcc", "#ff99ff", "#66ffff"];
  return colors[Math.floor(Math.random() * colors.length)];
}

function getColor() {
  if (color === "rainbow") return randomColor();
  if (color === "shimmer") return `hsl(${Math.random() * 360}, 100%, 75%)`;
  return color;
}

const fireflies = Array.from({ length: 50 }, () => ({
  x: Math.random() * canvas.width,
  y: Math.random() * canvas.height,
  vx: (Math.random() - 0.5) * 0.5,
  vy: (Math.random() - 0.5) * 0.5,
  r: Math.random() * fireflySize + 1,
  scale: Math.random() * 0.6 + 0.7,
  alpha: Math.random(),
  phase: Math.random() * Math.PI * 2,
}));

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  fireflies.forEach(f => {
    f.x += f.vx;
    f.y += f.vy;

    if (f.x < 0 || f.x > canvas.width) f.vx *= -1;
    if (f.y < 0 || f.y > canvas.height) f.vy *= -1;

    f.phase += 0.02;
    f.alpha = 0.5 + Math.sin(f.phase) * 0.3;

    const radius = f.r * f.scale;

    const gradient = ctx.createRadialGradient(f.x, f.y, 0, f.x, f.y, radius);
    gradient.addColorStop(0, `${getColor()}`);
    gradient.addColorStop(1, "transparent");

    ctx.globalAlpha = f.alpha;
    ctx.fillStyle = gradient;
    ctx.beginPath();
    ctx.arc(f.x, f.y, radius, 0, Math.PI * 2);
    ctx.fill();
  });

  ctx.globalAlpha = 1;
  requestAnimationFrame(draw);
}

draw();
</script>
</body>
</html>
